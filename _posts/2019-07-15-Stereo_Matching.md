---
title: stereo_matching(1)
date: 2019-07-15
categories: Deep-Learning
tags:
- depth estimation
---

　　CVPR2019年的论文，通过立体视觉算法解决深度估计的问题。<br>
　　Group-wise Correlation Stereo Network。<br>
　　FlowNet。<br>

<!-- more -->

## Group-wise Correlation Stereo Network

### Four tips
　　解决立体视觉的算法，通常会包含下面四个步骤：
1. 	matching cost computation：匹配代价计算，衡量待匹配像素与候选像素的相关性，尽量减少代价，代价越小，相关性越大，计算左图一个像素和右图一个像素之间的代价
2. 	cost aggregation：代价聚合。基于点之间的匹配很容易受到噪声的影响，往往真实匹配的像素的代价并不是最低。所以有必要在点的周围建立一个window，让像素块和像素块之间进行比较。代价聚合往往是局部算法或是半局部算法才会使用，全局算法抛弃了window，采用基于全图信息的方式建立能量函数。
3. 	disparity optimation：视差优化
4. 	post-processing：后处理

　　匹配代价计算能够提供初始的一个左图和可能与之对应的有图之间的相似度的衡量标准，这对于立体匹配来说是非常重要的一个步骤。
　　
## FlowNet

　　重新又回去看了FlowNet这篇论文，这篇论文是通过两张图像来预测两张图像的光流结果图。但是首先，什么是光流，它的作用是什么？<br>

### optical flow

　　从本质上说，光流就是你在这个运动着的世界里感觉到明显的视觉运动。看了一个博客，上面讲到，当我们坐在火车上，向窗户外看，可以看到树、地面、建筑等，都在往后面退，这个运动就是光流，而且他们的运动速度是不同的。这个提供了一个很重要的信息，通过不同目标的运动速度判断它们距离我们的远近。光流是空间运动物体在观测成像平面上的/*像素运动*/——所以对于光流的估计也可以用像素点的预测来进行。利用图像序列中像素在时间域上的变化以及相邻帧之间的相关性来找到上一帧和当前帧之间存在的对应关系，从而计算出相邻帧之间物体的运动信息的一种方法。<br>
　　又上百度上搜索了一下具体这个光学概念的含义，物体在运动的时候，它在图像上对应点的亮度模式也在运动。这种图像亮度模式的表观运动就是光流。所以提取一下关键字，光流是一种运动,是一种运动图像分析的重要方法。在另一个博客中，找到的答案是，光流指空间运动物体在观测成像平面上的像素运动的瞬时速度。<br>
　　研究光流场的目的就是为了从图片序列中近似得到不能直接得到的运动场。对光流技术进行总结，按照理论基础和数学方法的区别把它们分成四种，基于梯度的方法、基于匹配的方法、基于能量的方法和基于相位的方法。基于匹配的光流算法，主要包括基于特征和区域的两种，基于特征的方法不断地对目标特征进行定位和跟踪，对目标大的运动和亮度变化具有鲁棒性。存在的问题是光流通常很稀疏，而且特征提取和精确匹配也非常困难。基于区域的方法先对类似的区域进行定位，然后通过相似区域的位移计算光流。<br>
　　现在想想，大概能猜出来为什么光流的预测要和深度估计放在一起了，因为光流的预测需要相邻图像之间的视差，但是这个视差和深度估计需要用到的视差似乎还并不相同。
### Architecture

　　FlowNet提出了两个不同的网络模型结构。

![](/pic/flowS.png)

![](/pic/flowC.png)

　　第一个网络结构中，两张输入图像何为一张图像，然后六通道的图像作为输入，最后直接输出光流预测结果。对于第二种网络结构，作者在开始的时候设计了两个相互独立的网络分支，用来分别对输入的图像进行特征的提取，然后在稍后的阶段，将两个输入特征进行融合。通过这样的方式，能够相对独立地计算出有意义的特征，然后在更高层进行特征的合并。这样先进行特征提取然后比较两组图像的特征向量，类似于标准的匹配操作，但是给出了两张图像的特征向量之后，网络如何找到匹配关系？<br>
　　作者提出了一个很重要的层——correlation layer，来解决这个匹配操作的问题。corr layer的操作如下，在以x1和x2为中心的两个patch中，块长K=2K+1，大小为K^2<br>

$$
c(x_1,x_2)=\sum_{o\varepsilon[-k,k]\times[-k,k]}(f_1(x_1+o),f_2(x_2+o))
$$

　　这里用到的操作实际上和正常的卷积操作是相同的，只是卷积用到的是卷积核，卷积核的参数是可以进行学习的，而这里进行的相关操作是用两个特征层中的patch进行，也是先进行对应位置相乘，之后相加。然而如果不进行处理的话，计算的复杂度会很高，为了减小运算的复杂度，我们对位移范围进行约束，约束位移范围是d（上下左右移动d），就是每一个块只和它附近D：2d+1的位置块计算练习。而且以x1为中心的块和它附近D范围计算练习的时候，还可以加上步长，就是不需要和D范围的每个点都计算相关关系，可以进行跳着运算。最后输出的相关向量的size为whDD，最开始的时候没有想明白为什么是这样的一个输出尺寸，仔细想了以后应该这样理解：进行匹配运算的两组特征向量的spatial size是wh，然后以每一个点为中心，最后计算出来的spatial size也应该是wh，相关性的计算在第三维上展开，位移的每一步都填充在第三维度上，那为什么是D^2呢。这个相关性的计算应该是两组特征向量之间相互的，保持x1为中心的patch位置不变，然后计算以x2为中心周边D范围内的patch之间的关联，同理计算以x2为中心的patch保持不变和x1周边的相关，这样算下来就是D^2的深度。<br>
　　大型翻车现场，写完上面的这段内容，自己又推算了一遍，但是怎么都算不出来作者给出的这个理论值，又重新回去看了论文，发现作者这样写道: In practice we organize the raletive displacements in channels.	This means we obtain an output of size whDD.所以在得到这个输出的尺寸之前，作者是进行了额外操作的，应该是在计算的时候添加了stride。

